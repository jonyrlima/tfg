//****************************************************************************
// SPHERE by : Menasoft ï¿½1997-2016
// www.sphereserver.net
// All SPHERE script files and formats are copyright Menasoft & Partners.
// This file may be freely edited for personal use, but may not be distributed
// in whole or in part, in any format without express written permission from
// Menasoft & Partners.  All donations and contributions
// become the property of Menasoft & Partners.
//****************************************************************************
// FILE LAST UPDATED: Tuesday, Jun 28, 2016
//
VERSION=0.56d

[ADVANCE]
// Generic advance rates for stats
STR=1,2,4
INT=1,2,4
DEX=1,2,4

[COMMENT SKILL x]
ADV_RATE=10.0,200.0,800.0
// 10.0 successes at 0% to gain .1,
// 800.0 successes at 100% to gain .1,
// 200.0 successes at 50% to gain .1
GAINRADIUS=100.0
// Skillgain will only be calculated if the current skill is less than the
// actual difficulty + GAINRADIUS.  Used to prohibit skillgain by
// performing way too easy tasks.  Set to 100.0 for original behaviour.
VALUES=0,100
// The amount of value an item created with the skill gets at skill levels.
EFFECT=0,100
// Healing: Effect of bandages
// Crafting Skills: Percentage of resources lost on failure.
STAT_STR=80
// You will tend toward these stat vals if you use this skill a lot.
BONUS_STATS=10
// What percent of the skill success is based on stat levels. = 10%.
BONUS_STR=80
// % of each stat toward success at skill.

[SKILL 0]
DEFNAME=SKILL_ALCHEMY
KEY=Alchemy
TITLE=Alchemist
FLAGS=skf_craft
DELAY=0.8,0.6 // per stroke.
EFFECT=1.0,100.0
ADV_RATE=40.0,600.0,1000.0
VALUES=8.0,200.0,600.0
BONUS_STATS=1
BONUS_STR=0
BONUS_DEX=20
BONUS_INT=80
STAT_STR=5
STAT_INT=75
STAT_DEX=40

ON=@Fail
 SRC.SYSMESSAGE @0825 Voce falhou na sua mistura.
//src.ctag.alchemy_craft_baseid =
src.ctag.alchemy_craft_skillreq =

ON=@Abort
 SRC.SYSMESSAGE @0825 Skill Alchemy cancelada.
//src.ctag.alchemy_craft_baseid =
src.ctag.alchemy_craft_skillreq =

On=@Start
//src.ctag.alchemy_craft_baseid = <local.craftitemdef>
//src.emote start grinding some %s in the mortar
actdiff = 0
args = <explode " ",<serv.itemdef.<local.craftitemdef>.skillmake>>
src.ctag.alchemy_craft_skillreq = <eval <argv[0]> / 10>

ON=@SUCCESS
	actdiff = <src.ctag0.alchemy_craft_skillreq>
	local.skill = <eval <src.alchemy> / 10>
  	local.bonus = <eval <eval 100 - <local.skill>> / 2>
	local.min = <eval <eval <src.ctag.alchemy_craft_skillreq> - <local.skill>> + 20>
	local.min += <local.bonus>
	if <local.min> < 3
		local.min = 3
	endif
	local.max = <eval <eval <src.ctag.alchemy_craft_skillreq> - <local.skill>> + 25>
	local.max += <local.bonus>
	if (<local.max> < 5)
		local.max = 5
	elif (<local.max> > 70)
		local.max = 70
	endif
	local.fail_chance = <r<local.min>,<local.max>>
//src.say <dlocal.fail_chance> <dsrc.ctag.alchemy_craft_skillreq> - <dlocal.skill>
	if ((<SRC.FOOD> < <SRC.MAXFOOD>) || (<SRC.ALCHEMY> < 1000)) && (<r1,100> < <local.fail_chance>)
	//s falhou pelo f
		src.emote toss the failed mixture from the mortar.
		return 1
	endif
//src.emote pour the completed potion into a bottle.
skillgain Alchemy,<src.ctag0.alchemy_craft_skillreq>
RETURN 0

on=@GAIN
if <src.<argn1>> > 699
	return 1
endif


[FUNCTION f_returnarg]
return <argv[<argv[0]>]>

[SKILL 1]
DEFNAME=SKILL_ANATOMY
KEY=Anatomy
TITLE=Scholar
PROMPT_MSG=Whom shall I examine?
DELAY=1.5,1.0
ADV_RATE=7.0,100.0,300.0
BONUS_STATS=1
BONUS_STR=0
BONUS_DEX=0
BONUS_INT=100
STAT_STR=15
STAT_INT=70
STAT_DEX=15

ON=@Fail
 SRC.SYSMESSAGE @0825 Voce nao conseguiu identificar a criatura.

ON=@Abort
 SRC.SYSMESSAGE @0825 Skill Anatomy cancelada.

//OK
[SKILL 2]
DEFNAME=SKILL_ANIMAL_LORE
KEY=AnimalLore
TITLE=Naturalist
PROMPT_MSG=What animal should I look at?
DELAY=1.5,1.0
ADV_RATE=10.0,200.0,300.0
STAT_STR=0
STAT_INT=70
STAT_DEX=0
BONUS_STR=0
BONUS_DEX=0
BONUS_INT=100
BONUS_STATS=1

ON=@Fail
 SRC.SYSMESSAGE @0825 Voce nao conseguiu identificar o animal.

ON=@Abort
 SRC.SYSMESSAGE @0825 Skill AnimalLore cancelada.



//OK
[SKILL 3]
DEFNAME=SKILL_APPRAISE
KEY=ItemID
TITLE=Merchant
PROMPT_MSG=What do you wish to appraise and identify?
DELAY=1.0
ADV_RATE=20.0,200.0,600.0
STAT_STR=0
STAT_INT=85
STAT_DEX=0
BONUS_STR=0
BONUS_DEX=0
BONUS_INT=100
BONUS_STATS=1

ON=@Fail
 SRC.SYSMESSAGE You cant think of anything off hand

ON=@Abort
 SRC.SYSMESSAGE You stop trying to appraise the item.

//OK
[SKILL 4]
DEFNAME=SKILL_ARMSLORE
KEY=ArmsLore
TITLE=Armsman
PROMPT_MSG=What would you like to evaluate?
DELAY=1.0
STAT_STR=10
STAT_INT=50
STAT_DEX=15
BONUS_STR=33
BONUS_DEX=33
BONUS_INT=34
BONUS_STATS=1
ADV_RATE=8.0,100.0,200.0

ON=@Fail
 SRC.SYSMESSAGE @0825 Voce nao esta certo sobre este item.

ON=@Abort
 SRC.SYSMESSAGE @0825 Skill ArmsLore cancelada.

//OK
[SKILL 5]
DEFNAME=Skill_Parrying
KEY=Parrying
TITLE=Shieldfighter
FLAGS=skf_fight
ADV_RATE=1.0,1.0,1.0
EFFECT=2.0,90.0
STAT_STR=75
STAT_INT=15
STAT_DEX=25
BONUS_STR=50
BONUS_DEX=50
BONUS_INT=0
BONUS_STATS=1


[SKILL 6]
DEFNAME=Skill_Begging
KEY=Begging
TITLE=Beggar
PROMPT_MSG=Para quem voce deseja mendigar?
DELAY=2.0
ADV_RATE=20.0,200.0,600.0
STAT_STR=5
STAT_INT=55
STAT_DEX=25
BONUS_STR=0
BONUS_DEX=50
BONUS_INT=50
BONUS_STATS=10

ON=@Abort
	SRC.SYSMESSAGE You fail utterly in your attempt to grovel.
//REVISAR
[SKILL 7]
DEFNAME=Skill_Blacksmith
KEY=Blacksmithing
TITLE=Blacksmith
FLAGS=skf_craft
DELAY=1.5
STAT_STR=95
STAT_INT=15
STAT_DEX=25
BONUS_STR=75
BONUS_DEX=20
BONUS_INT=5
BONUS_STATS=1
ADV_RATE=40.0,600.0,1000.0
VALUES=1,20,100

ON=@Start
	IF (<f_get_real_skill <SRC.UID>,7> >= 1000)
		IF (<SRC.FOOD> >= <SRC.MAXFOOD>)
			SRC.ACTDIFF 0
		ENDIF
	ENDIF

ON=@Fail
 SRC.SYSMESSAGE @0825 Voce falhou ao criar o item.

ON=@Abort
 SRC.SYSMESSAGE @0825 Skill Blacksmithing cancelada.

on=@GAIN
if <src.<argn1>> > 699
	return 1
endif

//OK
[SKILL 8]
DEFNAME=Skill_Bowcraft
KEY=Bowcraft
TITLE=Bowyer
FLAGS=skf_craft
DELAY=2.0		//Old value=1.7
STAT_STR=40
STAT_INT=45
STAT_DEX=70
BONUS_STR=15
BONUS_DEX=70
BONUS_INT=15
BONUS_STATS=1
ADV_RATE=40.0,600.0,1000.0
VALUES=1,30,200

ON=@Fail
	SRC.SYSMESSAGE You fail to create the item

ON=@Abort
 SRC.SYSMESSAGE @0825 Skill Bowcraft cancelada.

on=@GAIN
if <src.<argn1>> > 699
	return 1
endif

//OK
[SKILL 9]
DEFNAME=Skill_Peacemaking
KEY=Peacemaking
TITLE=Bard
DELAY=2.0
STAT_STR=0
STAT_INT=70
STAT_DEX=70
BONUS_STR=0
BONUS_DEX=50
BONUS_INT=50
BONUS_STATS=1
ADV_RATE=20.0,300.0,700.0

ON=@Fail
 SRC.SYSMESSAGE @0825 Voce nao conseguiu acalmar a criatura.

ON=@Abort
 SRC.SYSMESSAGE @0825 Skill Peacemaking cancelada.

//OK
[SKILL 10]
DEFNAME=Skill_Camping
KEY=Camping
TITLE=Camper
DELAY=6.0
STAT_STR=30
STAT_INT=30
STAT_DEX=30
BONUS_STR=33
BONUS_DEX=33
BONUS_INT=34
BONUS_STATS=1
ADV_RATE=20.0,200.0,600.0

ON=@Fail
 SRC.SYSMESSAGE @0825 Voce nao conseguiu acender o fogo.

ON=@Abort
 SRC.SYSMESSAGE @0825 Skill Camping cancelada.

//REVISAR
[SKILL 11]
DEFNAME=Skill_Carpentry
KEY=Carpentry
TITLE=Carpenter
FLAGS=skf_craft
DELAY=1.2		//Old value=3.0
STAT_STR=60
STAT_INT=40
STAT_DEX=30
BONUS_STR=50
BONUS_DEX=30
BONUS_INT=20
BONUS_STATS=1
ADV_RATE=40.0,600.0,1000.0
VALUES=1,20,80

ON=@Fail
 SRC.SYSMESSAGE @0825 Voce falhou ao criar o item.

ON=@Abort
 SRC.SYSMESSAGE @0825 Skill Carpentry cancelada.

on=@GAIN
if <src.<argn1>> > 699
	return 1
endif

//REVISAR
[SKILL 12]
DEFNAME=Skill_Cartography
KEY=Cartography
TITLE=Cartographer
FLAGS=skf_craft
DELAY=3.0
STAT_STR=15
STAT_INT=70
STAT_DEX=20
BONUS_STR=0
BONUS_DEX=20
BONUS_INT=80
BONUS_STATS=1
ADV_RATE=15.0,600.0,1000.0
VALUES=1,20,80

ON=@Select
	SRC.SYSMESSAGE This skill cannot be used directly.
	return 1

ON=@Fail
	SRC.SYSMESSAGE Thy trembling hand results in an unusable map.

ON=@Abort
 SRC.SYSMESSAGE @0825 Skill Cartography cancelada.

on=@GAIN
if <src.<argn1>> > 699
	return 1
endif

//OK
[SKILL 13]
DEFNAME=Skill_Cooking
KEY=Cooking
TITLE=Chef
PROMPT_MSG=What would you like to cook?
FLAGS=skf_craft
DELAY=2.0		//Old value=1.5
STAT_STR=25
STAT_INT=45
STAT_DEX=20
BONUS_STR=0
BONUS_DEX=40
BONUS_INT=60
BONUS_STATS=1
ADV_RATE=40.0,600.0,1000.0
VALUES=1,20,80

ON=@Fail
	SRC.SYSMESSAGE You burn the food to a crisp! It is ruined.

ON=@Abort
	SRC.SYSMESSAGE You stop cooking the food.

on=@GAIN
if <src.<argn1>> > 699
	return 1
endif

//OK
[SKILL 14]
DEFNAME=Skill_DetectHidden
KEY=DetectingHidden
TITLE=Scout
DELAY=1.0,1.0
STAT_STR=15
STAT_INT=60
STAT_DEX=20
BONUS_STR=0
BONUS_DEX=20
BONUS_INT=80
BONUS_STATS=1
ADV_RATE=10.0,200.0,300.0

ON=@Fail
	SRC.SYSMESSAGE You can see nothing hidden there.

ON=@Abort
	SRC.SYSMESSAGE You stop looking for anything hidden.
//OK
[SKILL 15]
DEFNAME=Skill_Enticement
KEY=Enticement
TITLE=Demoralizer
PROMPT_MSG=Whom do you wish to entice?
DELAY=2.0
STAT_STR=15
STAT_INT=70
STAT_DEX=50
BONUS_STR=0
BONUS_DEX=50
BONUS_INT=50
BONUS_STATS=1
ADV_RATE=20.0,200.0,600.0

ON=@Fail
	SRC.SYSMESSAGE Your music fails to attract anyone.

ON=@Abort
 SRC.SYSMESSAGE @0825 Skill Enticement cancelada.

//OK
[SKILL 16]
DEFNAME=Skill_EvalInt
KEY=EvaluatingIntel
TITLE=Scholar
PROMPT_MSG=Select char to inspect.
DELAY=1.0
STAT_STR=5
STAT_INT=60
STAT_DEX=10
BONUS_STR=0
BONUS_DEX=0
BONUS_INT=100
BONUS_STATS=1
ADV_RATE=10.0,200.0,300.0

ON=@Fail
	SRC.SYSMESSAGE You cannot seem to judge the creature correctly.

ON=@Abort
	SRC.SYSMESSAGE You fail to inspect the creature completely.
//REVISAR
[SKILL 17]
DEFNAME=Skill_Healing
KEY=Healing
TITLE=Healer
PROMPT_MSG=Who will you use the bandages on?
DELAY=1.0,1.0
EFFECT=1.0
ADV_RATE=20.0,200.0,600.0
STAT_STR=10
STAT_INT=90
STAT_DEX=10
BONUS_STATS=1
BONUS_STR=0
BONUS_DEX=30
BONUS_INT=70

ON=@Abort
	SRC.SYSMESSAGE You stop applying the bandages.



//OK
[SKILL 18]
DEFNAME=Skill_Fishing
KEY=Fishing
TITLE=Fisherman
PROMPT_MSG=What water do you want to fish in?
FLAGS=skf_gather
DELAY=3.0
STAT_STR=40
STAT_INT=30
STAT_DEX=40
BONUS_STR=10
BONUS_DEX=90
BONUS_INT=0
BONUS_STATS=1
ADV_RATE=25.0,250.0,1000.0
VALUES=1,30,200
RANGE=4

ON=@PreStart
	IF (<SRC.FINDLAYER.layer_horse>)
		SRC.SYSMESSAGE You cant fish while riding!
		return 1
	ENDIF

ON=@Start
	ANIM 12
	SERV.NEWITEM i_memory_fishing_splash
	NEW.LINK=<UID>
	NEW.P=<ACT.P>

ON=@Success
if (<src.fishing> > 700) && (strmatch(*t_improved_pole*,<serv.itemdef.<src.findlayer.2.baseid>.tevents>))
	if (<r1,2> == 2)
		if (<src.restest i_misterious_bait>)
			if (<src.p.x> > 3467) && (<src.p.x> < 3703)
				if (<src.p.y> > 2574) && (<src.p.y> < 2828)
					src.consume 1 i_misterious_bait
					src.message @0800,,1 You have found some strange fish...
					serv.newitem i_misterious_fish
					src.bounce <new>
				endif
			endif
		endif
	endif
endif

if !(<src.ctag0.fishbufferzero>) && ((<var0.conta_<src.account.dtag0.global>.fishbuffer> > 399) || (<var0.buffervip<src.account.dtag0.global>_fish> > 399))
	if (<src.fishing> > 600) && (strmatch(*t_improved_pole*,<serv.itemdef.<src.findlayer.2.baseid>.tevents>))
		local.skillred <eval (<src.fishing>/10)>
		local.skillchance <eval (<local.skillred>*<local.skillred>*<local.skillred>*<local.skillred>)/1000>
		local.rand <r1,13333333>

		if (<local.rand> <= <local.skillchance>)
			//pegar SOS
			if (<src.ctag0.sosfound>)
				if (<r0,<src.dctag0.sosfound>> != 0)
					return 1
				endif
			endif
			Dorand 3
				src.sysmessage @,,1 A map has been found.
				src.sysmessage @,,1 Some sort of bottle has been found.
				src.sysmessage @,,1 You have found a bottle.
			enddo
			src.message Aye, seems like we found our next piece of gold!
			serv.newitem i_sos_bottle
			src.bounce <new>
			src.ctag0.sosfound += 1
			if (<var0.conta_<src.account.dtag0.global>.fishbuffer> > 399)
				var0.conta_<src.account.dtag0.global>.fishbuffer -= 400
				if (<var0.conta_<src.account.dtag0.global>.fishbuffer> < 0)
					var0.conta_<src.account.dtag0.global>.fishbuffer = 0
				endif
			elif (<var0.buffervip<src.account.dtag0.global>_fish> > 399)
				var0.buffervip<src.account.dtag0.global>_fish -= 400
				if (<var0.buffervip<src.account.dtag0.global>_fish> < 0)
					var0.buffervip<src.account.dtag0.global>_fish = 0
				endif
			endif
			return 1
		endif
	endif
endif
	ACTARG2=1		// 1 will pack the resource, 0 place it on the ground.

ON=@Fail
	SRC.SYSMESSAGE You fish a while, but fail to catch anything.

ON=@Abort
	SRC.SYSMESSAGE You pull your line back in and stop fishing.

ON=@Stroke
	IF (<SRC.FINDLAYER.layer_horse>)
		SRC.SYSMESSAGE You cant fish while riding!
		return 1
	ENDIF
	// Damage for Fishing Poles was never active, I add it here anyway.
	//IF ( <SERV.EXPERIMENTAL>&00002000)		// EF_DamageTools
	//	IF (<SRC.FINDLAYER.2.HITS> > 0)
	//		SRC.FINDLAYER.2.DAMAGE <eval <maxhits>*2>,DAM_PHYSICAL,<SRC>
	//	ELSE
	//		SRC.FINDLAYER.2.DESTROY
	//	ENDIF
	//ENDIF

on=@GAIN
if <src.<argn1>> > 699
	return 1
endif

[ITEMDEF i_memory_fishing_splash]
ID=i_memory

ON=@Create
ATTR=attr_move_never|attr_decay
TIMERD=15
IF (<TIMERD> > <SERV.SKILL.FISHING.DELAY>)	// We don't want to fire the splash after the fish success so a check for skill's delay is needed.
 TIMERD=<eval <SERV.SKILL.FISHING.DELAY>/2>
ENDIF

ON=@Timer
IF (<LINK.ACTION> == skill_fishing)		// Check out if cont is still fishing, otherwise we don't want the effect.
 EFFECT 2,0352D,4,16
 SOUND 0364
ENDIF

[SKILL 19]
DEFNAME=Skill_Forensics
KEY=Forensics
TITLE=Detective
PROMPT_MSG=What corpse would you like to examine?
DELAY=1.0
STAT_STR=10
STAT_INT=60
STAT_DEX=25
BONUS_STR=0
BONUS_DEX=0
BONUS_INT=100
BONUS_STATS=1
ADV_RATE=10.0,200.0,300.0


ON=@Fail
	SRC.SYSMESSAGE You can tell nothing about the corpse.

ON=@Abort
	SRC.SYSMESSAGE You decide you'd rather not look at that.

[SKILL 20]
DEFNAME=Skill_Herding
KEY=Herding
TITLE=Shepherd
DELAY=2.0
STAT_STR=50
STAT_INT=50
STAT_DEX=50
BONUS_STR=25
BONUS_DEX=45
BONUS_INT=30
BONUS_STATS=1
ADV_RATE=20.0,200.0,600.0
ON=@Fail
	SRC.SYSMESSAGE You don't seem to be able to persuade that to move.

ON=@Abort
	SRC.SYSMESSAGE You give up trying to persuade that to move.


[SKILL 21]
DEFNAME=Skill_Hiding
KEY=Hiding
TITLE=Rogue
DELAY=3.0
STAT_STR=20
STAT_INT=30
STAT_DEX=100
BONUS_STR=0
BONUS_DEX=80
BONUS_INT=20
BONUS_STATS=1
ADV_RATE=10.0,200.0,300.0

ON=@Fail
	SRC.SYSMESSAGE You can't seem to hide here.

ON=@Abort
	SRC.SYSMESSAGE You stop trying to hide.

[SKILL 22]
DEFNAME=Skill_Provocation
KEY=Provocation
TITLE=Bard
PROMPT_MSG=Quem voce quer provocar?
DELAY=3.0
STAT_STR=20
STAT_INT=60
STAT_DEX=70
BONUS_STR=0
BONUS_DEX=90
BONUS_INT=10
BONUS_STATS=1
ADV_RATE=20.0,200.0,600.0


ON=@SELECT
IF <FINDTYPE.T_musical.UID>==0
SYSMESSAGE Voce precisa de um instrumento musical para provocar alguem.
RETURN 1
ENDIF

IF (<FINDID.i_provoke_success>) || (<FINDID.i_provoke_fail>)
SYSMESSAGE Voce ja esta provocando alguem.
RETURN 1
ENDIF
TARGETF f_target_one
SYSMESSAGE Quem voce deseja provocar ?
RETURN 1
ENDIF
ENDIF



[FUNCTION f_target_one]
IF <ARGO.DISTANCE> > 3
SYSMESSAGE Voce esta muito longe do seu alvo.
RETURN 1
ENDIF




IF <ARGO.ISITEM>
SYSMESSAGE Somente em seres vivos.
RETURN 1
ENDIF
IF <ARGO.REGION.FLAGS>&04000
SYSMESSAGE Voce nao pode usar esta skill em regioes com guards
RETURN 1
ENDIF

IF <ARGO.ISPLAYER>
SYSMESSAGE Voce nao pode usar esta skill contra players
RETURN 1
ELSE
CTAG.PROVODIFF1 ((<ARGO.STR>*5) + <ARGO.DEX> + <ARGO.INT> + <ARGO.SKILLTOTAL>/10)
TAG.PROVOTARG1 <ARGO.UID>
TARGETF f_target_two
SYSMESSAGE Contra quem voce deseja provoca-lo ?
ENDIF


[FUNCTION f_target_two]
IF <ARGO.DISTANCE> > 3
SYSMESSAGE Voce esta muito longe do seu alvo.
RETURN 1
ENDIF

IF <ARGO.ISITEM>
SYSMESSAGE Somente em seres vivos.
RETURN 1
ENDIF
IF <ARGO.REGION.FLAGS>&04000
SYSMESSAGE Voce nao pode usar esta skill em regioes com guards
RETURN 1
ENDIF
IF <ARGO.ISPLAYER>
SYSMESSAGE Voce nao pode usar esta skill contra players
RETURN 1
ELSE
CTAG.PROVODIFF2 ((<ARGO.STR>*5) + <ARGO.DEX> + <ARGO.INT> + <ARGO.SKILLTOTAL>/10)
TAG.PROVOTARG2 <ARGO.UID>
IF <TAG.PROVOTARG1> == <TAG.PROVOTARG2>
SYSMESSAGE Voce nao pode provocar a fera contra ela mesma !
RETURN 1
ENDIF
f_provoke_action
RETURN 1
ENDIF

[FUNCTION f_provoke_action]
CTAG.BARDSKILLS= <EVAL ((<MUSICIANSHIP> * 3)  + (<PROVOCATION> * 7))/12>
IF (<CTAG.PROVODIFF1> >= <CTAG.PROVODIFF2>)
 IF RAND(<CTAG.PROVODIFF1>) < <CTAG.BARDSKILLS>
  NEWITEM i_provoke_success
  NEW.TIMER 2
  NEW.EQUIP
 ELSE
  NEWITEM i_provoke_fail
  NEW.TIMER 2
  NEW.EQUIP
 ENDIF
ELSE
 IF RAND(<CTAG.PROVODIFF2>) < <CTAG.BARDSKILLS>
  NEWITEM i_provoke_success
  NEW.TIMER 2
  NEW.EQUIP
 ELSE
  NEWITEM i_provoke_fail
  NEW.TIMER 2
  NEW.EQUIP
 ENDIF
ENDIF


[FUNCTION f_raise_provoke]
if <PROVOCATION> < 1000
  PROVOCATION += 1
endif


[ITEMDEF i_provoke_fail]
ID=i_memory
TYPE=t_eq_script

ON=@EQUIP
LINK=<SRC.UID>

ON=@TIMER

LINK.f_provoke_attack_self
LINK.SYSMESSAGE Voce falhou ao provocar a fera, e agora ela se volta contra voce !
TAG.PROVOTARG1
TAG.PROVOTARG2
REMOVE
RETURN 0

[ITEMDEF i_provoke_success]
ID=i_memory
TYPE=t_eq_script

ON=@EQUIP
LINK=<SRC.UID>

ON=@TIMER
CONT.f_raise_provoke
LINK.f_provoke_attack
LINK.SYSMESSAGE Voce provocou a fera com sucesso !!
TAG.PROVOTARG1
TAG.PROVOTARG2
REMOVE
RETURN 0

[FUNCTION f_provoke_attack_self]
TRY UID.<TAG.PROVOTARG1>.ATTACK <UID>
TRY UID.<TAG.PROVOTARG2>.ATTACK <UID>

[FUNCTION f_provoke_attack]
TRY UID.<TAG.PROVOTARG1>.ATTACK <TAG.PROVOTARG2>



ON=@Fail
	SRC.SYSMESSAGE Your music fails to incite enough anger.

ON=@Abort
	SRC.SYSMESSAGE You decide not to incite anything for now.

[SKILL 23]
DEFNAME=Skill_Inscription
KEY=Inscription
TITLE=Scribe
FLAGS=skf_craft
DELAY=2.0
STAT_STR=15
STAT_INT=100
STAT_DEX=15
BONUS_STR=0
BONUS_DEX=0
BONUS_INT=100
BONUS_STATS=1
ADV_RATE=40.0,600.0,1000.0
VALUES=1,30,200

ON=@Start
	IF (<SRC.FOOD> >= <SRC.MAXFOOD>) && (<f_get_real_skill <SRC.UID>,23> >= 1000)
		SRC.ACTDIFF 0
	ENDIF

ON=@Fail
 SRC.SYSMESSAGE @0825 Voce falhou na sua inscricao.
 SRC.CONSUME 1 i_scroll_blank

ON=@Abort
 SRC.SYSMESSAGE @0825 Voce falhou na sua inscricao.

ON=@SUCCESS
SRC.F_GM_QUEST_SKILL_INCREASE 23,<SRC.TAG0.SPELLNUM>

IF (<f_get_real_skill <SRC.UID>,23> >= 1000)
	SRC.MANA -= <EVAL ((<SERV.SPELL.<SRC.TAG0.SPELLNUM>.MANAUSE> * 80) / 100)>
ELSE
	SRC.MANA -= <SERV.SPELL.<SRC.TAG0.SPELLNUM>.MANAUSE>
ENDIF

SRC.TAG.SPELLNUM

on=@GAIN
if <src.<argn1>> > 699
	return 1
endif

[SKILL 24]
DEFNAME=Skill_Lockpick
KEY=Lockpicking
TITLE=Infiltrator
PROMPT_MSG=What do you want to pick?
DELAY=3.0
STAT_STR=20
STAT_INT=60
STAT_DEX=90
BONUS_STR=0
BONUS_DEX=80
BONUS_INT=20
BONUS_STATS=1
ADV_RATE=20.0,150.0,400.0

ON=@Fail
	SRC.SYSMESSAGE You are unable to pick the lock.
	if <src.Lockpicking> < 1000
		if <R0,<eval <src.Lockpicking>/3>> == 0
			src.Lockpicking += 1
		endif
	endif

on=@success
	if <src.Lockpicking> < 1000
		if <R0,<eval <src.Lockpicking>/3>> == 0
			src.Lockpicking += 1
		endif
	endif

ON=@Abort
	SRC.SYSMESSAGE You stop trying to pick the lock.

[SKILL 25]
DEFNAME=Skill_Magery
KEY=Magery
TITLE=Mage
FLAGS=skf_magic
STAT_STR=20
STAT_INT=100
STAT_DEX=40
BONUS_STR=0
BONUS_DEX=0
BONUS_INT=100
BONUS_STATS=1
ADV_RATE=1.0,1.0,1.0
VALUES=1,20,80
//DELAY=1.0 // based on skill and difficulty.

ON=@Start
	IF (<SRC.MAGERY> >= 1000)
		SRC.ACTDIFF 0
	ENDIF

// ON=@Fail
//  SRC.SYSMESSAGE @0825 Voce falhou a magia.

// ON=@Abort
//  SRC.SYSMESSAGE @0825 Skill Magery cancelada.


ON=@SpellEffect
IF (<ARGN> == 43) || (<ARGN> == 49) || (<ARGN> == 54) || (<ARGN> == 55) || (<ARGN> == 55) || (<ARGN> == 57)
 IF (<UID.<REGION.UID>.TYPE> == t_multi) || (<UID.<SRC.REGION.UID>.TYPE> == t_multi)
  IF (<CANSEELOS> == 0)
   SYSMESSAGE Voce foi protegido de uma magia de area!
   RETURN 1
  ENDIF
 ENDIF
ENDIF


[SKILL 26]
DEFNAME=Skill_MagicResist
KEY=MagicResistance
TITLE=Warder
EFFECT=0.0,90.0
STAT_STR=40
STAT_INT=100
STAT_DEX=40
BONUS_STR=0
BONUS_DEX=0
BONUS_INT=100
BONUS_STATS=1
ADV_RATE=20.0,300.0,700.0
ON=@Gain
	if (<src.tag0.avoid_magic_resist_gain>)
		src.tag.avoid_magic_resist_gain
		return 1
	endif

[SKILL 27]
DEFNAME=Skill_Tactics
KEY=Tactics
TITLE=Tactician
STAT_STR=60
STAT_INT=40
STAT_DEX=70
BONUS_STR=50
BONUS_DEX=50
BONUS_INT=0
BONUS_STATS=1
ADV_RATE=1.0,1.0,1.0

ON=@SUCCESS
	IF <SRC.TACTICS> < 1000
		SRC.TACTICS += 1
	ENDIF


[SKILL 28]
DEFNAME=Skill_Snooping
KEY=Snooping
TITLE=Spy
DELAY=2.0
STAT_STR=30
STAT_INT=50
STAT_DEX=60
BONUS_STR=0
BONUS_DEX=100
BONUS_INT=0
BONUS_STATS=1
ADV_RATE=20.0,200.0,600.0

ON=@Start
IF (<ACT.TOPOBJ.REGION.SAFE>)
 SRC.SYSMESSAGE You cant snoop anyone inside a safe region!
 RETURN 1
ENDIF

IF (<ACT.TOPOBJ.REGION.TAG0.PVM_ONLY>)
 SRC.SYSMESSAGE You cant steal anyone inside a pvm region!
 RETURN 1
ENDIF

ON=@Fail
 SRC.SYSMESSAGE @0825 Voce falhou ao tentar abrir esta bolsa.
 IF <SRC.KARMA> > -10000
  SRC.KARMA -= <R150,700>
 ENDIF

ON=@Abort
 SRC.SYSMESSAGE You give up trying to peek into the container.


ON=@success

 IF <SRC.KARMA> > -8000
  SRC.KARMA -= <R150,700>
 ENDIF


[SKILL 29]
DEFNAME=Skill_Musicianship
KEY=Musicianship
TITLE=Bard
DELAY=2.0
STAT_STR=20
STAT_INT=50
STAT_DEX=70
BONUS_STR=0
BONUS_DEX=80
BONUS_INT=20
BONUS_STATS=1
ADV_RATE=20.0,200.0,600.0
ON=@Fail
	SRC.SYSMESSAGE You play poorly, and there is no effect.

ON=@Abort
	SRC.SYSMESSAGE You put down your instrument.

[SKILL 30]
DEFNAME=Skill_Poisoning
KEY=Poisoning
TITLE=Assassin
PROMPT_MSG=To what do you wish to apply the poison?
DELAY=2.0
STAT_STR=15
STAT_INT=40
STAT_DEX=40
BONUS_STR=0
BONUS_DEX=20
BONUS_INT=80
BONUS_STATS=1
ADV_RATE=40.0,600.0,1000.0
VALUES=1,30,200

on=@GAIN
if <src.<argn1>> > 699
	return 1
endif


ON=@SELECT
IF !(<FINDID.i_poison_delay.UID>==0)
	SYSMESSAGE Voce ja esta tentando envenenar alguma arma
	RETURN 1
ENDIF


ON=@START
LOCAL.MOD_MAGICAL_WEAPON_POISONING_SKILL 0

IF (<SRC.TARG.MOREY>)
	LOCAL.MOD_MAGICAL_WEAPON_POISONING_SKILL = ((<SRC.TARG.MOREY> / 66) / 3) * 50

	IF (<ACT.TAG0.PLVL> == 3)
		LOCAL.MOD_MAGICAL_WEAPON_POISONING_SKILL += 100
	ELSEIF (<ACT.TAG0.PLVL> == 2)
		LOCAL.MOD_MAGICAL_WEAPON_POISONING_SKILL += 200
	ELSEIF (<ACT.TAG0.PLVL> == 1)
		LOCAL.MOD_MAGICAL_WEAPON_POISONING_SKILL += 700
	ENDIF
ENDIF

IF <ACT.TAG0.PLVL>==4
	IF <SRC.POISONING> < (700 + <dLOCAL.MOD_MAGICAL_WEAPON_POISONING_SKILL>)
		SRC.SYSMESSAGE Envenenar <SRC.TARG.NAME> com Deadly Poison necessita de <FVAL (700 + <dLOCAL.MOD_MAGICAL_WEAPON_POISONING_SKILL>)> de Poisoning
		RETURN 1
	ENDIF
ELIF <ACT.TAG0.PLVL>==3
	IF <SRC.POISONING> < (600 + <dLOCAL.MOD_MAGICAL_WEAPON_POISONING_SKILL>)
		SRC.SYSMESSAGE Envenenar <SRC.TARG.NAME> com Greater Poison necessita de <FVAL (600 + <dLOCAL.MOD_MAGICAL_WEAPON_POISONING_SKILL>)> de Poisoning
		RETURN 1
	ENDIF
ELIF <ACT.TAG0.PLVL>==2
	IF <SRC.POISONING> < (500 + <dLOCAL.MOD_MAGICAL_WEAPON_POISONING_SKILL>)
		SRC.SYSMESSAGE Envenenar <SRC.TARG.NAME> com Poison necessita de <FVAL (500 + <dLOCAL.MOD_MAGICAL_WEAPON_POISONING_SKILL>)> de Poisoning
		RETURN 1
	ENDIF
ELIF <ACT.TAG0.PLVL>==1
	IF <SRC.POISONING> < (<dLOCAL.MOD_MAGICAL_WEAPON_POISONING_SKILL>)
		SRC.SYSMESSAGE Envenenar <SRC.TARG.NAME> com Lesser Poison necessita de <FVAL (<dLOCAL.MOD_MAGICAL_WEAPON_POISONING_SKILL>)> de Poisoning
		RETURN 1
	ENDIF
ENDIF

LOCAL.AMOUNT_REQUIRED 1

IF (<SRC.TARG.ISTEVENT.t_pvm_level_item>)
	IF (<f_get_real_skill <SRC.UID>,30> < 1000)
		SRC.SYSMESSAGE You must have 100.0% of skill to poison this magic item.
		RETURN 1
	ELSEIF (<ACT.AMOUNT> < 1200)
		SRC.SYSMESSAGE You must have 1200 potions to poison this magic item.
		RETURN 1
	ELSE
		LOCAL.AMOUNT_REQUIRED 1200
	ENDIF
ENDIF

IF !((<SRC.TARG.TYPE>==t_weapon_sword) || (<SRC.TARG.TYPE>==t_weapon_axe) || (<SRC.TARG.TYPE>==t_weapon_fence))
	SRC.SYSMESSAGE Voce so pode envenenar armas cortantes.
	RETURN 1
ENDIF

IF !(<SRC.TARG.TAG0.POISONLEVEL>==0)
	SRC.SYSMESSAGE Esta arma ja esta envenenada.
	RETURN 1
ENDIF

SRC.TARG.TAG.ORIGNAME <SRC.TARG.NAME>
LOCAL.RAND <eval 300*<ACT.TAG0.PLVL>>

IF ((<f_get_real_skill <SRC.UID>,30> < 1000) || (<SRC.FOOD> < <SRC.MAXFOOD>)) && (<R<dLOCAL.RAND>> > <SRC.POISONING>)
 SERV.NEWITEM i_poison_delay
 NEW.EQUIP
 NEW.TIMER 2
 RETURN 1
ENDIF

SRC.TAG.POISON_AMOUNT_REQUIRED <LOCAL.AMOUNT_REQUIRED>
SRC.TAG.POISONTARG <SRC.TARG.UID>

ON=@Fail
 SRC.SYSMESSAGE Voce falhou ao tentar aplicar o veneno na arma.

ON=@Abort
 SRC.SYSMESSAGE Voce decidiu nao envenenar nada por hora.

ON=@SUCCESS
IF (<ACT.TAG0.PLVL>)
	LOCAL.POISON_AMOUNT_REQUIRED <SRC.TAG.POISON_AMOUNT_REQUIRED>
	LOCAL.POISONTARG <SRC.TAG.POISONTARG>

	SRC.TAG.POISON_AMOUNT_REQUIRED
	SRC.TAG.POISONTARG

	IF (<ACT.AMOUNT> > <LOCAL.POISON_AMOUNT_REQUIRED>)
		act.amount -= <LOCAL.POISON_AMOUNT_REQUIRED>
	ELSEIF (<ACT.AMOUNT> == <LOCAL.POISON_AMOUNT_REQUIRED>)
		ACT.REMOVE
	ELSE
		SRC.SYSMESSAGE You don't have the required amount to poison.
		RETURN 1
	ENDIF

	aplicapoison <ACT.TAG0.PLVL>, <LOCAL.POISONTARG>
	src.sysmessage @,,1 Voce aplicou o poison com sucesso.
		IF (<ACT.TAG0.PLVL>==4)
			skillgain Poisoning,95
			//src.consume 1 i_potion_PoisonDeadly
		ELIF <ACT.TAG0.PLVL>==3
			skillgain Poisoning,80
			//src.consume 1 i_potion_PoisonGreat
		ELIF <ACT.TAG0.PLVL>==2
			skillgain Poisoning,50
			//src.consume 1 i_potion_Poison
		ELSE
			skillgain Poisoning,10
			//src.consume 1 i_potion_PoisonLess
		ENDIF
		RETURN 1
ENDIF
RETURN 1

[ITEMDEF i_poison_delay]
NAME=Poison delay
ID=i_memory
TYPE=t_eq_script

ON=@CREATE
ATTR 096
LINK=<SRC.UID>

ON=@TIMER
LINK.SYSMESSAGE Voce falhou ao tentar aplicar o veneno na arma.
REMOVE
RETURN 0

[FUNCTION aplicapoison]
if <argv[0]>==1
TRY UID.<argv[1]>.TAG.ORIGNAME=<UID.<argv[1]>.tag.origname>
TRY UID.<argv[1]>.NAME Lesser Poisoned <UID.<argv[1]>.TAG0.ORIGNAME>
TRY UID.<argv[1]>.MORE2=20
TRY UID.<argv[1]>.MOREZ=0
TRY UID.<argv[1]>.TAG.POISONLEVEL 1
TRY UID.<argv[1]>.TAG.POISONTIMER 15
TRY UID.<argv[1]>.EVENTS +t_poisoned_weapon
elif <argv[0]>==2
TRY UID.<argv[1]>.TAG.ORIGNAME=<UID.<argv[1]>.tag.origname>
TRY UID.<argv[1]>.NAME Poisoned <UID.<argv[1]>.TAG0.ORIGNAME>
TRY UID.<argv[1]>.MORE2=15
TRY UID.<argv[1]>.MOREZ=0
TRY UID.<argv[1]>.TAG.POISONLEVEL 2
TRY UID.<argv[1]>.TAG.POISONTIMER 10
TRY UID.<argv[1]>.EVENTS +t_poisoned_weapon
elif <argv[0]>==3
TRY UID.<argv[1]>.TAG.ORIGNAME=<UID.<argv[1]>.tag.origname>
TRY UID.<argv[1]>.NAME Greater Poisoned <UID.<argv[1]>.TAG0.ORIGNAME>
TRY UID.<argv[1]>.MORE2=10
TRY UID.<argv[1]>.MOREZ=0
TRY UID.<argv[1]>.TAG.POISONLEVEL 3
TRY UID.<argv[1]>.TAG.POISONTIMER 5
TRY UID.<argv[1]>.EVENTS +t_poisoned_weapon
elif <argv[0]>==4
TRY UID.<argv[1]>.TAG.ORIGNAME=<UID.<argv[1]>.tag.origname>
TRY UID.<argv[1]>.NAME Deadly Poisoned <UID.<argv[1]>.TAG0.ORIGNAME>
TRY UID.<argv[1]>.MORE2=6
TRY UID.<argv[1]>.MOREZ=0
TRY UID.<argv[1]>.TAG.POISONLEVEL 4
TRY UID.<argv[1]>.TAG.POISONTIMER 3
TRY UID.<argv[1]>.EVENTS +t_poisoned_weapon
endif




[SKILL 31]
DEFNAME=Skill_Archery
KEY=Archery
TITLE=Archer
FLAGS=skf_fight|skf_ranged
//DELAY=0.8,0.1
STAT_STR=40
STAT_INT=30
STAT_DEX=70
BONUS_STR=0
BONUS_DEX=95
BONUS_INT=5
BONUS_STATS=1
ADV_RATE=1.0,1.0,1.0

//ON=@START
// IF (<UID.<REGION.UID>.TYPE> == t_multi) || (<UID.<SRC.REGION.UID>.TYPE> == t_multi)
//RETURN 1
//ENDIF


[SKILL 32]
DEFNAME=Skill_SpiritSpeak
KEY=SpiritSpeak
TITLE=Medium
PROMPT_MSG=
DELAY=2.0
STAT_STR=20
STAT_INT=70
STAT_DEX=30
BONUS_STR=0
BONUS_DEX=0
BONUS_INT=100
BONUS_STATS=1
ADV_RATE=20.0,200.0,600.0

ON=@Start
 say Ahn Mih Sah Ko
 sound 586
 anim 17

ON=@Success
 IF ((RAND(<EVAL (<SRC.SPIRITSPEAK> / 50)>) == 0) && (<SRC.SPIRITSPEAK> < 1000))

  SRC.SPIRITSPEAK += 1
 ENDIF

 LOCAL.radius = <EVAL (<SRC.SPIRITSPEAK> / 100)>
 IF (<LOCAL.radius> < 2)
  LOCAL.radius = 2
 ENDIF

 FORITEMS <LOCAL.radius>
  IF (<BASEID> == i_corpse) && !(<COLOR> == 039e)
    COLOR = 039e
   SRC.EFFECT = 3,i_fx_heal_effect, 0,20,1
   SRC.SYSMESSAGE You channel your own spiritual energy to heal your wounds.
   IF (<SRC.HITS> < <SRC.STR>)
    LOCAL.HITS = <EVAL ((<SRC.HITS>) + (<SRC.STR> / 50)) + (<SRC.SPIRITSPEAK> / 30))>
    IF (<LOCAL.HITS> > <SRC.STR>)
     SRC.HITS = <SRC.STR>
    ELSE
     SRC.HITS = <LOCAL.HITS>
    ENDIF
   ENDIF
   //RETURN 1
  ENDIF
 ENDFOR

 //SRC.SYSMESSAGE @0825 Voce falhou ao tentar se comunicar com os mortos. filho da puta que fez isso
 //RETURN 1

ON=@Fail
 SYSMESSAGE @0825 Voce falhou ao tentar se comunicar com os mortos.

ON=@Abort
 SYSMESSAGE @0825 Skill SpiritSpeak cancelada.


[SKILL 33]
DEFNAME=Skill_Stealing
KEY=Stealing
TITLE=Thief
PROMPT_MSG=Que item voce deseja tentar roubar?
DELAY=2.5
STAT_STR=40
STAT_INT=50
STAT_DEX=100
BONUS_STR=0
BONUS_DEX=100
BONUS_INT=0
BONUS_STATS=1
ADV_RATE=40.0,600.0,1000.0

ON=@START
IF !(<ACT.ISITEM>)
 SRC.SYSMESSAGE You cant steal that!
 RETURN 1
ENDIF
IF !(<ACT.TOPOBJ.ISPLAYER>)
 SRC.SYSMESSAGE You cant steal a npc!
 RETURN 1
ENDIF
IF (<ACT.TOPOBJ.REGION.SAFE>)
 SRC.SYSMESSAGE You cant steal anyone inside a safe region!
 RETURN 1
ENDIF
IF (<ACT.TOPOBJ.REGION.TAG0.PVM_ONLY>)
 SRC.SYSMESSAGE You cant steal anyone inside a pvm region!
 RETURN 1
ENDIF
IF ((<ACT.ATTR> & attr_newbie) || (<ACT.ATTR> & attr_move_never) || (<ACT.ATTR> & attr_static))
 SRC.SYSMESSAGE You cant steal that!
 RETURN 1
ENDIF
IF !(<SRC.FLAGS> & statf_criminal)
 IF (<SRC.KILLS> == 0)
  REF69 = <SRC.ACT.TOPOBJ.UID>
  REF69.f_sawcrime
 ENDIF
ENDIF


ON=@Fail
 SRC.SYSMESSAGE You fail to steal the item.
 IF <SRC.KARMA> > -10000
  SRC.KARMA -= <R150,700>
 ENDIF

ON=@Abort
 SRC.SYSMESSAGE You give up trying to steal the item.

ON=@SUCCESS
LOCAL.CALC <EVAL (800000/<SRC.STEALING>)/8> //r100 tem que ser <=6 para 100.0 de stealing nao ficar crim
LOCAL.RANDOM <R<dLocal.calc>>

 IF (<dlocal.random> > 60)
  SRC.BECRIMINAL
 ELSE
   RETURN 0
 ENDIF

[SKILL 34]
DEFNAME=Skill_Tailoring
KEY=Tailoring
TITLE=Tailor
FLAGS=skf_craft
DELAY=5.0		//Old value=4.5
STAT_STR=30
STAT_INT=30
STAT_DEX=60
BONUS_STR=5
BONUS_DEX=75
BONUS_INT=20
BONUS_STATS=1
ADV_RATE=40.0,600.0,1000.0
VALUES=1,20,80

ON=@Fail
	SRC.SYSMESSAGE Tailoring failed. Some of the cloth is ruined.

ON=@Abort
	SRC.SYSMESSAGE You decide not to sew anymore for now.

on=@GAIN
if <src.<argn1>> > 699
	return 1
endif

[SKILL 35]
DEFNAME=Skill_Taming
KEY=Taming
TITLE=Animal Tamer
PROMPT_MSG=Domar qual animal?
DELAY=2.0
STAT_STR=30
STAT_INT=40
STAT_DEX=60
BONUS_STR=30
BONUS_DEX=10
BONUS_INT=60
BONUS_STATS=1
ADV_RATE=40.0,600.0,1000.0

ON=@SELECT
SRC.SYSMESSAGE Use the Tame Harp to tame.
RETURN 1

on=@GAIN
if <src.<argn1>> > 699
	return 1
endif

[SKILL 36]
DEFNAME=Skill_TasteId
KEY=TasteID
TITLE=Food Taster
PROMPT_MSG=What would you like to taste?
DELAY=1.0
STAT_STR=25
STAT_INT=50
STAT_DEX=15
BONUS_STR=20
BONUS_DEX=0
BONUS_INT=80
BONUS_STATS=1
ADV_RATE=10.0,200.0,300.0
ON=@Fail
	SRC.SYSMESSAGE You cannot discern anything about this substance.

ON=@Abort
	SRC.SYSMESSAGE You decide against tasting anything.

[SKILL 37]
DEFNAME=Skill_Tinkering
KEY=Tinkering
TITLE=Tinker
FLAGS=skf_craft
DELAY=2.0		//Old value=3.0
STAT_STR=30
STAT_INT=100
STAT_DEX=50
BONUS_STR=20
BONUS_DEX=20
BONUS_INT=60
BONUS_STATS=1
ADV_RATE=40.0,600.0,1000.0
VALUES=1,20,80

ON=@Fail
	SRC.SYSMESSAGE Tinkering failed.

ON=@Abort
	SRC.SYSMESSAGE You stop trying to make anything.

on=@GAIN
if <src.<argn1>> > 699
	return 1
endif

[SKILL 38]
DEFNAME=Skill_Tracking
KEY=Tracking
TITLE=Ranger
PROMPT_MSG=What do you wish to track?
DELAY=3.0
STAT_STR=25
STAT_INT=50
STAT_DEX=50
BONUS_STR=0
BONUS_DEX=50
BONUS_INT=50
BONUS_STATS=1
ADV_RATE=20.0,200.0,450.0

ON=@PreStart
	IF !(<SRC.ISPLAYER>)
	 return 1
	ENDIF

ON=@Stroke
	LOCAL.ModZ=<eval <ACT.P.Z>/-10>
	SRC.ARROWQUEST <eval <ACT.P.X>+<LOCAL.ModZ>>,<eval <ACT.P.Y>+<LOCAL.ModZ>>,38

ON=@Select
IF (<SERV.TIME> < <ctag0.skillrecovery>)
SRC.SYSMESSAGE @,,1 Voce deve aguardar para usar esta skill novamente.
RETURN 1
ENDIF
ctag.skillrecovery=<eval <serv.time> + 30>

ON=@Fail
	SRC.SYSMESSAGE Tracking failed.

ON=@Abort
	SRC.SYSMESSAGE You stop tracking.
	SRC.ARROWQUEST 0,0,38

[SKILL 39]
DEFNAME=Skill_Vet
KEY=Veterinary
TITLE=Veterinarian
PROMPT_MSG=What animal would you like to heal?
DELAY=2.0
STAT_STR=30
STAT_INT=50
STAT_DEX=40
BONUS_STR=20
BONUS_DEX=20
BONUS_INT=60
BONUS_STATS=1
ADV_RATE=20.0,200.0,450.0

ON=@Fail
	SRC.SYSMESSAGE You apply the bandages, but they barely help.

ON=@Abort
	SRC.SYSMESSAGE You stop applying the bandages.

[SKILL 40]
DEFNAME=Skill_Swordsmanship
KEY=Swordsmanship
TITLE=Swordsman
FLAGS=skf_fight
STAT_STR=75
STAT_INT=40
STAT_DEX=75
BONUS_STR=50
BONUS_DEX=50
BONUS_INT=0
BONUS_STATS=1
ADV_RATE=1.0,1.0,1.0

[SKILL 41]
DEFNAME=Skill_Macefighting
KEY=Macefighting
TITLE=Armsman
FLAGS=skf_fight
STAT_STR=100
STAT_INT=35
STAT_DEX=55
BONUS_STR=80
BONUS_DEX=20
BONUS_INT=0
BONUS_STATS=1
ADV_RATE=1.0,1.0,1.0

[SKILL 42]
DEFNAME=Skill_Fencing
KEY=Fencing
TITLE=Fencer
FLAGS=skf_fight
STAT_STR=55
STAT_INT=60
STAT_DEX=95
BONUS_STR=20
BONUS_DEX=80
BONUS_INT=0
BONUS_STATS=1
ADV_RATE=1.0,1.0,1.0

[SKILL 43]
DEFNAME=Skill_Wrestling
KEY=Wrestling
TITLE=Wrestler
FLAGS=skf_fight
STAT_STR=100
STAT_INT=30
STAT_DEX=75
BONUS_STR=50
BONUS_DEX=50
BONUS_INT=0
BONUS_STATS=1
ADV_RATE=1.0,1.0,1.0

[SKILL 44]
DEFNAME=Skill_Lumberjack
KEY=Lumberjacking
TITLE=Lumberjack
FLAGS=skf_gather
DELAY=1.6
STAT_STR=85
STAT_INT=30
STAT_DEX=45
BONUS_STR=90
BONUS_DEX=10
BONUS_INT=0
BONUS_STATS=1
ADV_RATE=25.0,250.0,1000.0
VALUES=1,10,50
RANGE=2

ON=@Fail
	SRC.SYSMESSAGE You hack at the tree for a while, but fail to produce any useable wood.

ON=@Abort
	SRC.SYSMESSAGE You decide not to chop wood for now.

ON=@Stroke
	IF (<R30> == 1)
		IF ( <SERV.EXPERIMENTAL>&00002000)		// EF_DamageTools
			IF (<SRC.WEAPON.HITS> > 0)
				SRC.WEAPON.DAMAGE <eval <maxhits>*2>,DAM_PHYSICAL,<SRC>
			ELSE
				SRC.WEAPON.DESTROY 1
			ENDIF
		ENDIF
	ENDIF

on=@GAIN
if <src.<argn1>> > 699
	return 1
endif

[SKILL 45]
DEFNAME=Skill_Mining
KEY=Mining
TITLE=Miner
PROMPT_MSG=Where would you like to mine?
FLAGS=skf_gather
DELAY=1.6
EFFECT=10
STAT_STR=85
STAT_INT=30
STAT_DEX=45
BONUS_STR=70
BONUS_DEX=30
BONUS_INT=0
BONUS_STATS=1
ADV_RATE=15.0,200.0,700.0
VALUES=1,10,80
RANGE=2

ON=@UseQuick
	IF (<SRC.FOOD> >= <SRC.MAXFOOD>) && (<f_get_real_skill <SRC.UID>,45> >= 1000)
		ARGN3=1
	ENDIF

on=@GAIN
if <src.<argn1>> > 699
	return 1
endif

ON=@Fail
	SRC.SYSMESSAGE You loosen some rocks but fail to find any useable ore.

ON=@Abort
	SRC.SYSMESSAGE You decide not to mine for now.

ON=@Stroke
	IF (<R40> == 1)
		IF ( <SERV.EXPERIMENTAL>&00002000)		// EF_DamageTools
			IF (<SRC.WEAPON.HITS> > 0)
				SRC.WEAPON.DAMAGE <eval <maxhits>*2>,DAM_PHYSICAL,<SRC>	// 2 of 16 chances to receive damage.
			ELSE
				SRC.WEAPON.DESTROY
			ENDIF
		ENDIF
	ENDIF

[SKILL 46]
DEFNAME=Skill_Meditation
KEY=Meditation
TITLE=Stoic
DELAY=1.0,1.5
STAT_STR=10
STAT_INT=100
STAT_DEX=10
BONUS_STR=5
BONUS_DEX=90
BONUS_INT=5
BONUS_STATS=1
ADV_RATE=1.0,1.0,1.0

ON=@Fail
 SRC.SYSMESSAGE @0825 Voce perdeu sua concentracao.

ON=@Abort
	//SRC.f_meditation_setup
	SRC.SYSMESSAGE You stop concentrating.

ON=@Start
	//SRC.f_meditation_setup

ON=@Success
	//SRC.f_meditation_setup


[function f_meditation_setup]
// This enables OSI meditation, providing a passive boost to RegenMana everytime and increasing it when the skill is active instead of the old regen-when-active.
if (<tag0.MeditBonus>)
	RegenMana -=<tag.MeditBonus>	// Removing old bonus before applying new one.
endif
tag.MeditBonus
if (<tag0.MeditPenalty>)			// No Bonus when wearing plate armor
	return 0
endif
local.baseBonus=<eval ((<Meditation>/10) * 3) + <int>>	// Bonus given by meditation and int
if (<Meditation> >= 1000)	// GM medit gets a +10% bonus
	local.baseBonus += <muldiv <dlocal.baseBonus>,10,100>
endif
tag.MeditBonus=<eval 2 + <local.baseBonus> / 40>	// This is the value applied to RegenMana
if (<action>==Meditation)	// If we are meditating the bonus gets doubled.
	tag.MeditBonus *=2
endif
RegenMana += <tag.MeditBonus>

[SKILL 47]
DEFNAME=Skill_Stealth
KEY=Stealth
TITLE=Rogue
DELAY=3.0
STAT_STR=20
STAT_INT=30
STAT_DEX=100
BONUS_STR=0
BONUS_DEX=80
BONUS_INT=20
BONUS_STATS=1
ADV_RATE=10.0,100.0,300.0

ON=@Start
	IF (<FLAGS> & statf_invisible)
		SYSMESSAGE You cant use stealth while invisible under effect of magic or potion.
		return 1
	ELIF !(<FLAGS> & statf_hidden)
		SYSMESSAGE You must use the hiding skill first.
		return 1
	ELIF (<HIDING> < 80.0)
		SYSMESSAGE You are not hidden well enough. Get better at hiding.
		REVEAL
		return 1
	ELIF (<GetCharArmorRating> >= 42)
		SYSMESSAGE You could not hope to move quietly wearing this much armor.
		REVEAL
		return 1
	ENDIF

ON=@Success
	STEPSTEALTH = <eval <STEALTH>/50>
	SYSMESSAGE You begin to move quietly.

ON=@Fail
 SRC.SYSMESSAGE @0825 Voce nao conseguiu se esconder aqui.

ON=@Abort
	SYSMESSAGE You give up trying to hide here.

[FUNCTION GetCharArmorRating]
ARGS=4,6,7,10,13,19
WHILE (<dARGS>)
 IF !(<FINDLAYER.<ARGV0>.MageArmor>)
  LOCAL.AR += <DEF0.ArmorRating.<FINDLAYER.<ARGV0>.GetArmorMaterial>.Layer<ARGV0>>
 ENDIF
 ARGS=<STREAT <ARGS>>
ENDWHILE
return <LOCAL.AR>

[FUNCTION GetArmorMaterial]
IF (<DISPIDDEC> >= 5061) && (<DISPIDDEC> <= 5075)
 return Leather
ELIF (<DISPIDDEC> >= 5076) && (<DISPIDDEC> <= 5090)
 return Studded
ELIF (<DISPIDDEC> >= 5198) && (<DISPIDDEC> <= 5207)
 return Bone
ELIF (<DISPIDDEC> >= 5093) && (<DISPIDDEC> <= 5106)
 return Ring
ELIF (<DISPIDDEC> >= 5051) && (<DISPIDDEC> <= 5060)
 return Chain
ELIF (<DISPIDDEC> >= 5128) && (<DISPIDDEC> <= 5146)
 return Plate
ELIF (<DISPIDDEC> >= 9793) && (<DISPIDDEC> <= 9800)
 return Dragon
ENDIF

[DEFNAME ArmorRating]
ArmorRating.Studded.Layer4	6
ArmorRating.Studded.Layer7	2
ArmorRating.Studded.Layer10	2
ArmorRating.Studded.Layer13	10
ArmorRating.Studded.Layer19	4
ArmorRating.Bone.Layer4		15
ArmorRating.Bone.Layer6		10
ArmorRating.Bone.Layer7		5
ArmorRating.Bone.Layer13	25
ArmorRating.Bone.Layer19	10
ArmorRating.Ring.Layer4		15
ArmorRating.Ring.Layer7		5
ArmorRating.Ring.Layer13	25
ArmorRating.Ring.Layer19	10
ArmorRating.Chain.Layer4	15
ArmorRating.Chain.Layer6	10
ArmorRating.Chain.Layer13	25
ArmorRating.Plate.Layer4	15
ArmorRating.Plate.Layer6	10
ArmorRating.Plate.Layer7	5
ArmorRating.Plate.Layer10	5
ArmorRating.Plate.Layer13	25
ArmorRating.Plate.Layer19	10
ArmorRaring.Dragon.Layer4	15
ArmorRaring.Dragon.Layer6	10
ArmorRaring.Dragon.Layer7	5
ArmorRaring.Dragon.Layer13	25
ArmorRaring.Dragon.Layer19	10


[SKILL 48]
DEFNAME=Skill_Remove_Trap
KEY=RemoveTrap
TITLE=Trap Specialist
PROMPT_MSG=Select the trap to disarm
DELAY=7.0,3.0,2.0
STAT_STR=20
STAT_INT=60
STAT_DEX=90
BONUS_STR=0
BONUS_DEX=80
BONUS_INT=20
BONUS_STATS=1
ADV_RATE=20.0,200.0,600.0

ON=@Fail
	SRC.SYSMESSAGE You fail to disarm the trap.

ON=@Abort
	SRC.SYSMESSAGE You give up trying to disarm the trap.

[SKILL 49]
DEFNAME=Skill_Necromancy
KEY=Necromancy
TITLE=Necromancer
STAT_STR=20
STAT_INT=100
STAT_DEX=40
BONUS_STR=0
BONUS_DEX=0
BONUS_INT=100
BONUS_STATS=1
ADV_RATE=20.0,300.0,750.0
// VALUES=1,10,80

ON=@Fail
	SRC.SYSMESSAGE The spell fizzles.

ON=@Abort
	SRC.SYSMESSAGE You stop casting the spell.

[SKILL 50]
DEFNAME=SKILL_Focus
KEY=Focus
TITLE=Stoic
STAT_STR=10
STAT_INT=100
STAT_DEX=10
BONUS_STR=0
BONUS_DEX=0
BONUS_INT=0
BONUS_STATS=1
ADV_RATE=20.0,200.0,600.0

[SKILL 51]
DEFNAME=SKILL_CHIVALRY
KEY=Chivalry
TITLE=Paladin
FLAGS=skf_magic
STAT_STR=100
STAT_INT=35
STAT_DEX=55
BONUS_STR=80
BONUS_DEX=20
BONUS_INT=0
//BONUS_STATS=10
ADV_RATE=20.0,200.0,600.0

[SKILL 52]
DEFNAME=SKILL_BUSHIDO
KEY=Bushido
TITLE=Samurai
FLAGS=skf_fight
STAT_STR=55
STAT_INT=60
STAT_DEX=95
BONUS_STR=20
BONUS_DEX=80
BONUS_INT=0
//BONUS_STATS=10
ADV_RATE=10.0,150.0,600.0

[SKILL 53]
DEFNAME=SKILL_NINJITSU
KEY=Ninjitsu
TITLE=Ninja
FLAGS=skf_fight
STAT_STR=55
STAT_INT=60
STAT_DEX=95
BONUS_STR=20
BONUS_DEX=80
BONUS_INT=0
//BONUS_STATS=10
ADV_RATE=10.0,150.0,600.0

[SKILL 54]
DEFNAME=SKILL_SPELLWEAVING
KEY=Spellweaving
TITLE=Arcanist
FLAGS=skf_magic
STAT_STR=20
STAT_INT=70
STAT_DEX=30
BONUS_STR=0
BONUS_DEX=0
BONUS_INT=100
//BONUS_STATS=50
ADV_RATE=2.5,50.0,200.0

[SKILL 55]
DEFNAME=Skill_Mysticism
KEY=Mysticism
TITLE=Mystic
FLAGS=skf_magic
STAT_STR=20
STAT_DEX=30
STAT_INT=70
BONUS_STR=0
BONUS_DEX=0
BONUS_INT=100
BONUS_STATS=50
ADV_RATE=2.5,50.0,200.0

[SKILL 56]
DEFNAME=Skill_Imbuing
KEY=Imbuing
TITLE=Artificer
DELAY=3.0
STAT_STR=15
STAT_DEX=15
STAT_INT=100
BONUS_STR=0
BONUS_DEX=0
BONUS_INT=100
BONUS_STATS=10
ADV_RATE=10.0,200.0,800.0
VALUES=1,30,200

[SKILL 57]
DEFNAME=Skill_Throwing
KEY=Throwing
TITLE=Bladeweaver
FLAGS=skf_fight|skf_ranged
STAT_STR=40
STAT_DEX=70
STAT_INT=30
BONUS_STR=0
BONUS_DEX=95
BONUS_INT=5
BONUS_STATS=10
ADV_RATE=10.0,200.0,800.0

[SKILLCLASS 0]
// undeclared class.
// max skills for players of this skill class.
// might want this to be all 50.0 to make people declare a class?
DEFNAME=Class_undeclared
NAME=undeclared
// EVENTS=e_ClassUndeclared
STATSUM=300
SKILLSUM=55000
STR=100
INT=100
DEX=100
Alchemy=100.0
Anatomy=100.0
AnimalLore=100.0
ItemId=100.0
ArmsLore=100.0
Parrying=100.0
Begging=100.0
Blacksmithing=100.0
Bowcraft=100.0
Peacemaking=100.0
Camping=100.0
Carpentry=100.0
Cartography=100.0
Cooking=100.0
DetectingHidden=100.0
Enticement=100.0
EvaluatingIntel=100.0
Healing=100.0
Fishing=100.0
Forensics=100.0
Herding=100.0
Hiding=100.0
Provocation=100.0
Inscription=100.0
LockPicking=100.0
Magery=100.0
MagicResistance=100.0
Tactics=100.0
Snooping=100.0
Musicianship=100.0
Poisoning=100.0
Archery=100.0
SpiritSpeak=100.0
Stealing=100.0
Tailoring=100.0
Taming=100.0
TasteId=100.0
Tinkering=100.0
Tracking=100.0
Veterinary=100.0
Swordsmanship=100.0
Macefighting=100.0
Fencing=100.0
Wrestling=100.0
Lumberjacking=100.0
Mining=100.0
Meditation=100.0
Stealth=100.0
RemoveTrap=100.0
Necromancy=100.0
Focus=100.0
Chivalry=100.0
Bushido=100.0
Ninjitsu=100.0
Spellweaving=100.0
Mysticism=100.0
Imbuing=100.0
Throwing=100.0

ON=@LOGIN
IF !(<SRC.ISGM>)
	IF (<TAG0.BADNAME> == 1)
		IF (<SRC.ISEVENT.E_GERAIS>)
			SRC.F_GO HELP ROOM
			SRC.NAMECHANGE
		ENDIF
	ENDIF
ENDIF

if (<src.isplayer>) && !(<src.isgm>)
	if (<src.body> != c_man) && (<src.body> != c_woman) && (<src.body> != c_ghost_man) && (<src.body> != c_ghost_woman)
		SERV.LOG Changing <SRC.NAME> body (<SRC.BODY> / <SRC.OBODY>) to c_man.
		src.obody = c_man
		src.body = <src.body>
		src.updatex
	endif
endif

IF !(<ISEVENT.E_GERAIS>)
	EVENTS +E_GERAIS
ENDIF

IF !(<ISEVENT.E_ANIMALFIX>)
	EVENTS +e_animalfix
ENDIF

sysmessage @0481 Bem Vindo a The Fifteen Gems! Verificando seu IP....

IF !(<ISEMPTY <ACCOUNT.TAG.PAGE>>)
	SERV.NEWITEM I_PAGET
	EQUIP <NEW.UID>
	NEW.TIMER 10
ENDIF

SRC.IpChecker

ON=@CLICK
IF (<ACCOUNT.PLEVEL> > 1)
IF (<ACCOUNT.PLEVEL>==2)
 MESSAGE @00bb7,3 (Staff)
 RETURN 0
ELSEIF (<ACCOUNT.PLEVEL>==3)
 MESSAGE @00bb7,3 (Staff)
 RETURN 0
ELSEIF (<ACCOUNT.PLEVEL>==4)
 MESSAGE @00bb7,3 (Staff)
  MESSAGE @,,3 GM <name>
 RETURN 1
ELSEIF (<ACCOUNT.PLEVEL>==5)
 MESSAGE @00bb7,3 (Staff)
 MESSAGE @00bb7 Senior GM <name>
 RETURN 1
ELSEIF (<UID> == 04b8c8)
 MESSAGE @,,1 (eu tenho um jeito sereno de ser e toda noite no teu quarto venho te entorpecer, te entorpecer ye ye)
 MESSAGE @<tag.name.hue>,,1  <name>
 return 1
ELSEIF (<ACCOUNT.PLEVEL>==6)
 MESSAGE @00bb7,3 (Staff)
 RETURN 0
ELSEIF (<ACCOUNT.PLEVEL>==7)
 MESSAGE @00bb7,3 (Staff)
 MESSAGE @<TAG.NAME.HUE> Admin <Name>
 Return 1
ENDIF
ENDIF

[EOF]
